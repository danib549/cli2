<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HTML Calculator</title>
  <style>
    :root {
      --bg: #0b1220;
      --panel: #101a33;
      --key: #16234a;
      --key2: #1c2c5f;
      --text: #e8eefc;
      --muted: #9bb0e8;
      --accent: #5eead4;
      --danger: #fb7185;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1000px 700px at 20% 10%, #16244b 0%, var(--bg) 55%),
                  radial-gradient(900px 600px at 80% 90%, #0d2a3f 0%, var(--bg) 60%);
      color: var(--text);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 24px;
    }

    .calc {
      width: min(420px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .header {
      padding: 16px 18px 0;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
    }

    .header h1 {
      font-size: 16px;
      margin: 0;
      font-weight: 650;
      letter-spacing: .2px;
    }

    .header .hint {
      font-size: 12px;
      color: var(--muted);
      margin: 0;
      white-space: nowrap;
    }

    .display {
      padding: 14px 18px 18px;
    }

    .screen {
      width: 100%;
      border-radius: 14px;
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.08);
      padding: 14px 14px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
      display: grid;
      gap: 6px;
      min-height: 84px;
    }

    .expr {
      font-size: 14px;
      color: var(--muted);
      text-align: right;
      word-break: break-word;
      min-height: 18px;
    }

    .result {
      font-size: 30px;
      font-weight: 700;
      text-align: right;
      letter-spacing: .2px;
      word-break: break-word;
    }

    .keys {
      padding: 14px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      background: rgba(0,0,0,.12);
      border-top: 1px solid rgba(255,255,255,.06);
    }

    button.key {
      appearance: none;
      border: 0;
      border-radius: 14px;
      padding: 14px 12px;
      font-size: 16px;
      font-weight: 650;
      color: var(--text);
      background: linear-gradient(180deg, var(--key2), var(--key));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 6px 14px rgba(0,0,0,.25);
      cursor: pointer;
      transition: transform .05s ease, filter .15s ease;
      user-select: none;
    }

    button.key:active {
      transform: translateY(1px);
      filter: brightness(1.05);
    }

    button.key.op { color: var(--accent); }
    button.key.danger { color: var(--danger); }

    button.key.wide { grid-column: span 2; }

    .footer {
      padding: 0 18px 16px;
      color: rgba(255,255,255,.55);
      font-size: 12px;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</head>
<body>
  <main class="calc" aria-label="Calculator">
    <div class="header">
      <h1>Calculator</h1>
      <p class="hint">Keyboard: 0–9, + - * /, Enter, Backspace</p>
    </div>

    <section class="display">
      <div class="screen" role="group" aria-label="Display">
        <div id="expr" class="expr" aria-live="polite"></div>
        <div id="result" class="result" aria-live="polite">0</div>
      </div>
      <div class="sr-only" id="a11y-status" aria-live="polite"></div>
    </section>

    <section class="keys" aria-label="Keys">
      <button class="key danger" data-action="clear" aria-label="Clear">AC</button>
      <button class="key" data-action="back" aria-label="Backspace">⌫</button>
      <button class="key op" data-value="(" aria-label="Left parenthesis">(</button>
      <button class="key op" data-value=")" aria-label="Right parenthesis">)</button>

      <button class="key" data-value="7">7</button>
      <button class="key" data-value="8">8</button>
      <button class="key" data-value="9">9</button>
      <button class="key op" data-value="/">÷</button>

      <button class="key" data-value="4">4</button>
      <button class="key" data-value="5">5</button>
      <button class="key" data-value="6">6</button>
      <button class="key op" data-value="*">×</button>

      <button class="key" data-value="1">1</button>
      <button class="key" data-value="2">2</button>
      <button class="key" data-value="3">3</button>
      <button class="key op" data-value="-">−</button>

      <button class="key wide" data-value="0">0</button>
      <button class="key" data-value=".">.</button>
      <button class="key op" data-value="+">+</button>

      <button class="key wide op" data-action="equals" aria-label="Equals">=</button>
    </section>

    <div class="footer">Tip: use parentheses. Example: (12.5+7)/3</div>
  </main>

  <script>
    const exprEl = document.getElementById('expr');
    const resultEl = document.getElementById('result');
    const a11y = document.getElementById('a11y-status');

    let expr = '';
    let justEvaluated = false;

    function setStatus(msg) {
      a11y.textContent = msg;
    }

    function render(preview = true) {
      exprEl.textContent = expr;

      if (!expr) {
        resultEl.textContent = '0';
        return;
      }

      if (preview) {
        const v = tryEval(expr);
        resultEl.textContent = v === null ? '…' : formatNumber(v);
      }
    }

    function formatNumber(n) {
      if (!Number.isFinite(n)) return 'Error';
      // avoid 0.3000000004 style
      const rounded = Math.round((n + Number.EPSILON) * 1e12) / 1e12;
      return String(rounded);
    }

    function sanitizeExpression(s) {
      // Allow digits, operators, dot, spaces, parentheses
      // Also normalize common symbols.
      return s
        .replace(/×/g, '*')
        .replace(/÷/g, '/')
        .replace(/−/g, '-')
        .replace(/\s+/g, '');
    }

    function isAllowedExpression(s) {
      // only these characters
      if (!/^[0-9+\-*/().]*$/.test(s)) return false;
      // basic operator sanity: prevent **, //, etc.
      if (/(\*\*|\/\/|\+\+|--|\(\)|\.\.|\+\*|\*\+|\/-|\*\/)/.test(s)) return false;
      return true;
    }

    function tryEval(s) {
      const cleaned = sanitizeExpression(s);
      if (!isAllowedExpression(cleaned)) return null;

      // don't eval if it ends with an operator or dot
      if (/[+\-*/.]$/.test(cleaned)) return null;

      try {
        // Use Function instead of eval; still validate strictly above.
        // eslint-disable-next-line no-new-func
        const fn = new Function(`return (${cleaned});`);
        const val = fn();
        if (typeof val !== 'number') return null;
        return val;
      } catch {
        return null;
      }
    }

    function appendValue(v) {
      if (justEvaluated) {
        // if user types a number/dot/paren after '=', start fresh
        if (/^[0-9.(]$/.test(v)) expr = '';
        justEvaluated = false;
      }
      expr += v;
      render(true);
    }

    function clearAll() {
      expr = '';
      justEvaluated = false;
      render(false);
      setStatus('Cleared');
    }

    function backspace() {
      if (justEvaluated) justEvaluated = false;
      expr = expr.slice(0, -1);
      render(true);
    }

    function equals() {
      const v = tryEval(expr);
      if (v === null) {
        resultEl.textContent = 'Error';
        setStatus('Error');
        return;
      }
      resultEl.textContent = formatNumber(v);
      exprEl.textContent = expr + ' =';
      expr = String(formatNumber(v));
      justEvaluated = true;
      setStatus('Result: ' + expr);
    }

    document.querySelectorAll('button.key').forEach(btn => {
      btn.addEventListener('click', () => {
        const action = btn.dataset.action;
        const value = btn.dataset.value;

        if (action === 'clear') return clearAll();
        if (action === 'back') return backspace();
        if (action === 'equals') return equals();
        if (value) return appendValue(value);
      });
    });

    window.addEventListener('keydown', (e) => {
      const k = e.key;

      if (k === 'Escape') { e.preventDefault(); clearAll(); return; }
      if (k === 'Backspace') { e.preventDefault(); backspace(); return; }
      if (k === 'Enter' || k === '=') { e.preventDefault(); equals(); return; }

      if (/^[0-9]$/.test(k)) { e.preventDefault(); appendValue(k); return; }
      if (k === '.') { e.preventDefault(); appendValue('.'); return; }
      if (k === '(' || k === ')') { e.preventDefault(); appendValue(k); return; }
      if (k === '+' || k === '-' || k === '*' || k === '/') { e.preventDefault(); appendValue(k); return; }
    });

    render(false);
  </script>
</body>
</html>
